<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Powder Averaged CoRh‚ÇÇO‚ÇÑ at Finite Temperature ¬∑ Sunny documentation</title><meta name="title" content="Powder Averaged CoRh‚ÇÇO‚ÇÑ at Finite Temperature ¬∑ Sunny documentation"/><meta property="og:title" content="Powder Averaged CoRh‚ÇÇO‚ÇÑ at Finite Temperature ¬∑ Sunny documentation"/><meta property="twitter:title" content="Powder Averaged CoRh‚ÇÇO‚ÇÑ at Finite Temperature ¬∑ Sunny documentation"/><meta name="description" content="Documentation for Sunny documentation."/><meta property="og:description" content="Documentation for Sunny documentation."/><meta property="twitter:description" content="Documentation for Sunny documentation."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../index.html"><img src="../../assets/logo.png" alt="Sunny documentation logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../index.html">Sunny documentation</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../index.html">Overview</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../01_LSWT_CoRh2O4.html">Spin wave simulations of CoRh‚ÇÇO‚ÇÑ</a></li><li><a class="tocitem" href="../02_LSWT_SU3_FeI2.html">Multi-flavor spin wave simulations of FeI‚ÇÇ</a></li><li><a class="tocitem" href="../03_LLD_CoRh2O4.html">Landau-Lifshitz dynamics of CoRh‚ÇÇO‚ÇÑ at finite <em>T</em></a></li><li><a class="tocitem" href="../04_GSD_FeI2.html">Generalized spin dynamics of FeI‚ÇÇ at finite <em>T</em></a></li><li><a class="tocitem" href="../05_MC_Ising.html">Monte Carlo sampling of the Ising model</a></li><li><a class="tocitem" href="../06_CP2_Skyrmions.html">Dynamical quench into CP¬≤ skyrmion liquid</a></li><li><input class="collapse-toggle" id="menuitem-2-7" type="checkbox"/><label class="tocitem" for="menuitem-2-7"><span class="docs-label">SpinW tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../spinw/SW08_Kagome_AFM.html">Tutorial 8 - Kagome Antiferromagnet</a></li><li><a class="tocitem" href="../spinw/SW15_Ba3NbFe3Si2O14.html">Tutorial 15 - Ba‚ÇÉNbFe‚ÇÉSi‚ÇÇO‚ÇÅ‚ÇÑ</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-8" type="checkbox" checked/><label class="tocitem" for="menuitem-2-8"><span class="docs-label">Contributed</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href="CoRh2O4-tutorial.html">Powder Averaged CoRh‚ÇÇO‚ÇÑ at Finite Temperature</a><ul class="internal"><li><a class="tocitem" href="#Load-pacakges."><span>Load pacakges.</span></a></li><li><a class="tocitem" href="#Define-custom-functions."><span>Define custom functions.</span></a></li><li><a class="tocitem" href="#System-Definition-for-CoRhO"><span>System Definition for CoRh‚ÇÇO‚ÇÑ</span></a></li><li><a class="tocitem" href="#Thermalize-system-to-an-ordered,-yet-finite-temperature,-state"><span>Thermalize system to an ordered, yet finite temperature, state</span></a></li><li><a class="tocitem" href="#Calculation-of-Neutron-Scattering-Responses"><span>Calculation of Neutron Scattering Responses</span></a></li></ul></li><li><a class="tocitem" href="MgCr2O4-tutorial.html">MgCr2O4 at Finite Temperature</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-9" type="checkbox"/><label class="tocitem" for="menuitem-2-9"><span class="docs-label">Advanced</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../parallelism.html">Parallelizing Calculations</a></li><li><a class="tocitem" href="../../writevtk.html">ParaView Rendering</a></li></ul></li></ul></li><li><span class="tocitem">Modeling Guides</span><ul><li><a class="tocitem" href="../../structure-factor.html">Structure Factor Calculations</a></li><li><a class="tocitem" href="../../renormalization.html">Interaction Strength Renormalization</a></li></ul></li><li><a class="tocitem" href="../../library.html">Library API</a></li><li><a class="tocitem" href="../../versions.html">Version History</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li><a class="is-disabled">Contributed</a></li><li class="is-active"><a href="CoRh2O4-tutorial.html">Powder Averaged CoRh‚ÇÇO‚ÇÑ at Finite Temperature</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="CoRh2O4-tutorial.html">Powder Averaged CoRh‚ÇÇO‚ÇÑ at Finite Temperature</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SunnySuite/Sunny.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ÔÇõ</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SunnySuite/Sunny.jl/blob/main/docs/src/examples/contributed/CoRh2O4-tutorial.md" title="Edit source on GitHub"><span class="docs-icon fa-solid">ÔÅÑ</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Powder-Averaged-CoRhO-at-Finite-Temperature"><a class="docs-heading-anchor" href="#Powder-Averaged-CoRhO-at-Finite-Temperature">Powder Averaged CoRh‚ÇÇO‚ÇÑ at Finite Temperature</a><a id="Powder-Averaged-CoRhO-at-Finite-Temperature-1"></a><a class="docs-heading-anchor-permalink" href="#Powder-Averaged-CoRhO-at-Finite-Temperature" title="Permalink"></a></h1><p><strong>Inspired by</strong>: <a href="https://doi.org/10.1103/PhysRevB.96.064413">Ge et al., Phys. Rev. B 96, 064413 (2017)</a></p><p><strong>Authors</strong>: Martin Mourigal, David Dahlbom</p><p><strong>Date</strong>: October 28, 2023  (Sunny 0.5.5)</p><p><strong>Goal</strong>: This script is to calculate the temperature dependence of the magnon excitations in the spin-3/2 Heisenberg Diamond Antiferromagnet and compare to powder-averaged results obtained for the compound CoRh‚ÇÇO‚ÇÑ</p><h2 id="Load-pacakges."><a class="docs-heading-anchor" href="#Load-pacakges.">Load pacakges.</a><a id="Load-pacakges.-1"></a><a class="docs-heading-anchor-permalink" href="#Load-pacakges." title="Permalink"></a></h2><pre><code class="language-julia hljs">using Sunny, GLMakie, ProgressMeter, Statistics, Random, Brillouin
cif_path = pkgdir(Sunny, &quot;examples&quot;, &quot;longer_examples&quot;, &quot;CoRh2O4_#109301.cif&quot;);</code></pre><h2 id="Define-custom-functions."><a class="docs-heading-anchor" href="#Define-custom-functions.">Define custom functions.</a><a id="Define-custom-functions.-1"></a><a class="docs-heading-anchor-permalink" href="#Define-custom-functions." title="Permalink"></a></h2><p>The function <code>quench!</code> randomizes the spins of a given <code>System</code>, fixes a target temperature, and lets the system relax at this temperature for <code>nrelax</code> integration steps.</p><pre><code class="language-julia hljs">function quench!(sys, integrator; kTtarget, nrelax)
    randomize_spins!(sys);
    integrator.kT = kTtarget;
    prog          = Progress(nrelax; dt=10.0, desc=&quot;Quenched and now relaxing: &quot;, color=:green);
    for _ in 1:nrelax
        step!(sys, integrator)
        next!(prog)
    end
end</code></pre><pre><code class="nohighlight hljs">quench! (generic function with 1 method)</code></pre><p><code>dwell!</code> takes a <code>System</code>, sets a target temperature, and has the system dwell at this temperature for <code>ndwell</code> integration steps.</p><pre><code class="language-julia hljs">function dwell!(sys, integrator; kTtarget, ndwell)
    integrator.kT = kTtarget;
    prog          = Progress(ndwell; dt=10.0, desc=&quot;Dwelling: &quot;, color=:green);
    for _ in 1:ndwell
        step!(sys, integrator)
        next!(prog)
    end
end</code></pre><pre><code class="nohighlight hljs">dwell! (generic function with 1 method)</code></pre><p><code>anneal!</code> takes a temperature schedule and cools the <code>System</code> through it, with <code>ndwell</code> steps of the integrator at each temperature in the schedule. Returns the energy at the end of the dwell for each scheduled temperature.</p><pre><code class="language-julia hljs">function anneal!(sys,  integrator;  kTschedule, ndwell)
    nspins = prod(size(sys.dipoles));
    ensys  = zeros(length(kTschedule))
    prog   = Progress(ndwell*length(kTschedule); dt=10.0, desc=&quot;Annealing: &quot;, color=:red);
    for (i, kT) in enumerate(kTschedule)
        integrator.kT = kT
        for _ in 1:ndwell
            step!(sys, integrator)
            next!(prog)
        end
        ensys[i] = energy(sys)
    end
    return ensys/nspins
end</code></pre><pre><code class="nohighlight hljs">anneal! (generic function with 1 method)</code></pre><p><code>sample_sf!</code> samples a structure factor, which may be either an instant or dynamical structure factor. The integrator is run <code>ndecorr</code> times before each one of the samples is taken.</p><pre><code class="language-julia hljs">function sample_sf!(sf, sys, integrator; nsamples, ndecorr)
    prog  = Progress(nsamples*ndecorr; dt=10.0, desc=&quot;Sampling SF: &quot;, color=:red);
    for _ in 1:nsamples
        for _ in 1:ndecorr
            step!(sys, integrator)
            next!(prog)
        end
        add_sample!(sf, sys)    # Accumulate the newly sampled structure factor into `sf`
    end
end</code></pre><pre><code class="nohighlight hljs">sample_sf! (generic function with 1 method)</code></pre><p><code>powder_average</code> powder averages a structure factor. Works for both instant and dynamical structure factors. To prevent smearing, removes Bragg peaks before introducing energy broadening. Bragg peaks are added back at œâ=0 after broadening.</p><pre><code class="language-julia hljs">function powder_average(sc, rs, npts, formula; Œ∑=0.1)
    prog   = Progress(length(rs); dt=10., desc=&quot;Powder Averaging: &quot;, color=:blue)
    œâs = available_energies(sc)
    output = zeros(Float64, length(rs), length(œâs))
    for (i, r) in enumerate(rs)
        qs = reciprocal_space_shell(sc.crystal, r, npts)
        vals = intensities_interpolated(sc, qs, formula)
        bragg_idxs = findall(x -&gt; x &gt; maximum(vals)*0.9, vals)
        bragg_vals = vals[bragg_idxs]
        vals[bragg_idxs] .= 0
        vals = broaden_energy(sc, vals, (œâ,œâ‚ÇÄ)-&gt;lorentzian(œâ-œâ‚ÇÄ, Œ∑))
        vals[bragg_idxs] .= bragg_vals
        output[i,:] .= mean(vals, dims=1)[1,:]
        next!(prog)
    end
    return output
end</code></pre><pre><code class="nohighlight hljs">powder_average (generic function with 1 method)</code></pre><h2 id="System-Definition-for-CoRhO"><a class="docs-heading-anchor" href="#System-Definition-for-CoRhO">System Definition for CoRh‚ÇÇO‚ÇÑ</a><a id="System-Definition-for-CoRhO-1"></a><a class="docs-heading-anchor-permalink" href="#System-Definition-for-CoRhO" title="Permalink"></a></h2><p>Define the crystal structure of CoRh‚ÇÇO‚ÇÑ in the conventional cell.</p><pre><code class="language-julia hljs">xtal    = Crystal(cif_path; symprec=1e-4)
magxtal = subcrystal(xtal,&quot;Co1&quot;)
view_crystal(magxtal, 6.0)</code></pre><p><img src="CoRh2O4-tutorial-17.png" alt/></p><p>Print the symmetry-allowed interactions.</p><pre><code class="language-julia hljs">print_symmetry_table(magxtal, 4.0)</code></pre><pre><code class="nohighlight hljs">Atom 1
Type &#39;Co1&#39;, position [0, 0, 0], multiplicity 8
Allowed g-tensor: [A 0 0
                   0 A 0
                   0 0 A]
Allowed anisotropy in Stevens operators:
    c‚ÇÅ*(ùí™[4,0]+5ùí™[4,4]) +
    c‚ÇÇ*(ùí™[6,0]-21ùí™[6,4])

Sunny.Bond(1, 3, [0, 0, 0])
Distance 3.6784429025744, coordination 4
Connects &#39;Co1&#39; at [0, 0, 0] to &#39;Co1&#39; at [1/4, 1/4, 1/4]
Allowed exchange matrix:[A B B
                         B A B
                         B B A]

</code></pre><p>Assign local Hilbert space</p><pre><code class="language-julia hljs">S = 3/2
lhs = [SpinInfo(1; S, g=2)]
formfactors = [FormFactor(&quot;Co2&quot;)];</code></pre><p>Create <code>System</code> and randomize it</p><pre><code class="language-julia hljs">sunmode = :dipole
latsize = (10,10,10)
sys     = System(magxtal, latsize, lhs, sunmode; seed=1)
randomize_spins!(sys)
plot_spins(sys)</code></pre><p><img src="CoRh2O4-tutorial-23.png" alt/></p><p>Define exchange interactions.</p><pre><code class="language-julia hljs">scaleJ = 0.63
valJ1  = 1.00*scaleJ
set_exchange!(sys, valJ1, Bond(1, 3, [0, 0, 0]));</code></pre><h2 id="Thermalize-system-to-an-ordered,-yet-finite-temperature,-state"><a class="docs-heading-anchor" href="#Thermalize-system-to-an-ordered,-yet-finite-temperature,-state">Thermalize system to an ordered, yet finite temperature, state</a><a id="Thermalize-system-to-an-ordered,-yet-finite-temperature,-state-1"></a><a class="docs-heading-anchor-permalink" href="#Thermalize-system-to-an-ordered,-yet-finite-temperature,-state" title="Permalink"></a></h2><p>Define Langevin Integrator and Initialize it</p><pre><code class="language-julia hljs">Œît0        = 0.05/abs(scaleJ*S); ## Time steps in Langevin
Œª0         = 0.1; ## Langevin damping, usually 0.05 or 0.1 is good.
kT0        = 0.01*abs(scaleJ*S); ## Initialize at some temperature
integrator = Langevin(Œît0; Œª=Œª0, kT=kT0);</code></pre><p>Thermalization Option 1: Quench the system from infinite temperature to a target temperature. Note: this may lead to a poorly thermalized sample</p><pre><code class="language-julia hljs">quench!(sys, integrator; kTtarget=kT0, nrelax=10000);</code></pre><p>Option 2: Anneal (according to a temperature schedule) then dwell once we&#39;ve reach base temperature.  (Uncomment to execute.)</p><pre><code class="language-julia hljs"># kTs = [abs(scaleJ)*valS*100 * 0.9^k for k in 0:100]
# anneal!(sys,integrator;kTschedule=kTs,ndwell=500)
# dwell!(sys,integrator;kTtarget=kTs[end],ndwell=2000)</code></pre><p>Plot the resulting spin system to check ordering in real space</p><pre><code class="language-julia hljs">plot_spins(sys)</code></pre><p><img src="CoRh2O4-tutorial-34.png" alt/></p><h2 id="Calculation-of-Neutron-Scattering-Responses"><a class="docs-heading-anchor" href="#Calculation-of-Neutron-Scattering-Responses">Calculation of Neutron Scattering Responses</a><a id="Calculation-of-Neutron-Scattering-Responses-1"></a><a class="docs-heading-anchor-permalink" href="#Calculation-of-Neutron-Scattering-Responses" title="Permalink"></a></h2><h3 id="Fourier-transformed-instantaneous-two-point-correlation-functions"><a class="docs-heading-anchor" href="#Fourier-transformed-instantaneous-two-point-correlation-functions">Fourier transformed instantaneous two-point correlation functions</a><a id="Fourier-transformed-instantaneous-two-point-correlation-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Fourier-transformed-instantaneous-two-point-correlation-functions" title="Permalink"></a></h3><p>Calculate the instantaneous/equal-time structure factor.</p><pre><code class="language-julia hljs">eqsf = instant_correlations(sys)</code></pre><pre><code class="nohighlight hljs">SampledCorrelations (6.252 MiB)
[S(q) | 0 sample]
Lattice: (10, 10, 10)√ó8
6 correlations in Dipole mode:
‚ïî ‚¨§ ‚¨§ ‚¨§ Sx
‚ïë ‚ãÖ ‚¨§ ‚¨§ Sy
‚ïö ‚ãÖ ‚ãÖ ‚¨§ Sz
</code></pre><p>If desired, add additional samples by decorrelating and then re-calculating the eqsf.</p><pre><code class="language-julia hljs">nsamples   = 1
ndecorr    = 1000
@time sample_sf!(eqsf, sys, integrator; nsamples=nsamples, ndecorr=ndecorr);</code></pre><pre><code class="nohighlight hljs">  0.966485 seconds (1.89 M allocations: 118.815 MiB, 6.25% gc time, 50.12% compilation time)
</code></pre><p>Project onto a constant Q-Slice in momentum space.</p><pre><code class="language-julia hljs">nQpts  = 200
Qxpts  = range(-10.0, 10.0, length=nQpts)
Qypts  = range(-10.0, 10.0, length=nQpts)
qz     = 1.0
Qpts   = [[qx, qy, qz] for qx in Qxpts, qy in Qypts]
instant_formula = intensity_formula(eqsf, :perp; formfactors)
iq = instant_intensities_interpolated(eqsf, Qpts, instant_formula);</code></pre><p>Plot the resulting I(Q)</p><pre><code class="language-julia hljs">heatmap(Qxpts, Qypts, iq;
    colorrange = (0, maximum(iq)/20),
    axis = (
        xlabel=&quot;Momentum Transfer Qx (r.l.u)&quot;, xlabelsize=16,
        ylabel=&quot;Momentum Transfer Qy (r.l.u)&quot;, ylabelsize=16,
        aspect=true,
    )
)</code></pre><p><img src="CoRh2O4-tutorial-44.png" alt/></p><h3 id="Dynamical-and-energy-integrated-two-point-correlation-functions"><a class="docs-heading-anchor" href="#Dynamical-and-energy-integrated-two-point-correlation-functions">Dynamical and energy-integrated two-point correlation functions</a><a id="Dynamical-and-energy-integrated-two-point-correlation-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Dynamical-and-energy-integrated-two-point-correlation-functions" title="Permalink"></a></h3><p>Calculate the time traces and Fourier transform: Dynamical Structure Factor (first sample).</p><pre><code class="language-julia hljs">œâmax     = 6.0  # Maximum  energy to resolve
nœâ       = 100  # Number of energies to resolve
sc  = dynamical_correlations(sys; Œît=Œît0, nœâ=nœâ, œâmax=œâmax, process_trajectory=:symmetrize)
@time add_sample!(sc, sys) # Add a sample trajectory</code></pre><pre><code class="nohighlight hljs">  5.471269 seconds (14.33 M allocations: 291.526 MiB, 0.75% gc time, 0.02% compilation time)
</code></pre><p>If desired, add additional decorrelated samples.</p><pre><code class="language-julia hljs">nsamples      = 10
ndecorr       = 1000
@time sample_sf!(sc, sys, integrator; nsamples=nsamples, ndecorr=ndecorr);</code></pre><pre><code class="nohighlight hljs">Sampling SF:  27%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé                           |  ETA: 0:00:33[KSampling SF:  49%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä                   |  ETA: 0:00:25[KSampling SF:  68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ            |  ETA: 0:00:17[KSampling SF:  84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà      |  ETA: 0:00:09[KSampling SF: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| Time: 0:00:53[K
 59.070784 seconds (143.58 M allocations: 2.866 GiB, 0.56% gc time, 0.24% compilation time)
</code></pre><p>Can use the Brillouin package for help on determining high symmetry points</p><pre><code class="language-julia hljs">kp        = irrfbz_path(227,[[1,0,0], [0,1,0], [0,0,1]])
kpc       = cartesianize(kp)</code></pre><pre><code class="nohighlight hljs">KPath{3} (6 points, 2 paths, 8 points in paths):
 points: :U =&gt; [1.570796, 6.283185, 1.570796]
         :W =&gt; [3.141593, 6.283185, 0.0]
         :K =&gt; [4.712389, 4.712389, 0.0]
         :Œì =&gt; [0.0, 0.0, 0.0]
         :L =&gt; [3.141593, 3.141593, 3.141593]
         :X =&gt; [0.0, 6.283185, 0.0]
  paths: [:Œì, :X, :U]
         [:K, :Œì, :L, :W, :X]
  basis: [-6.283185, 6.283185, 6.283185]
         [6.283185, -6.283185, 6.283185]
         [6.283185, 6.283185, -6.283185]</code></pre><p>Project onto a constant QE-Slice in momentum-energy space.</p><pre><code class="language-julia hljs">densQpts  = 50
symQpts   = [[0.75, 0.75, 0.00],  # List of wave vectors that define a path
            [0.00, 0.00, 0.00],
            [0.50, 0.50, 0.50],
            [0.50, 1.00, 0.00],
            [0.00, 1.00, 0.00],
            [0.25, 1.00, 0.25],
            [0.00, 1.00, 0.00],
            [0.00,-4.00, 0.00]]
(Qpts, xticks) = reciprocal_space_path(magxtal, symQpts, densQpts)
formula = intensity_formula(sc, :perp; formfactors, kT=integrator.kT)
iqw = intensities_interpolated(sc, Qpts, formula);</code></pre><p>If desired, broaden the sc in energy.</p><pre><code class="language-julia hljs">Œ∑     = 0.1 ## Lorentzian energy broadening parameter
iqwc  = broaden_energy(sc, iqw, (œâ, œâ‚ÇÄ) -&gt; lorentzian(œâ-œâ‚ÇÄ, Œ∑));</code></pre><p>If desired, calculated the energy-integrated structure factor</p><pre><code class="language-julia hljs">iqt = instant_intensities_interpolated(sc, Qpts, formula);</code></pre><p>Plot the resulting I(Q,W).</p><pre><code class="language-julia hljs">œâs = available_energies(sc)
heatmap(1:size(iqwc, 1), œâs, iqwc;
    colorrange = (0, maximum(iqwc)/20000.0),
    axis = (;
        xlabel=&quot;Momentum Transfer (r.l.u)&quot;,
        ylabel=&quot;Energy Transfer (meV)&quot;,
        xticks,
        xticklabelrotation=œÄ/5,
        aspect = 1.4,
    )
)</code></pre><p><img src="CoRh2O4-tutorial-59.png" alt/></p><p>Projection into a powder-averaged neutron scattering intensity .</p><pre><code class="language-julia hljs">Qmax       = 3.5
nQpts      = 100
Qpow       = range(0, Qmax, nQpts)
npoints    = 100
pqw = powder_average(sc, Qpow, npoints, formula; Œ∑);</code></pre><pre><code class="nohighlight hljs">Powder Averaging:  78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä       |  ETA: 0:00:03[KPowder Averaging: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| Time: 0:00:12[K
</code></pre><p>Plot resulting Ipow(|Q|,W).</p><pre><code class="language-julia hljs">heatmap(Qpow, œâs, pqw;
    axis = (
        xlabel=&quot;|Q| (√Ö‚Åª¬π)&quot;,
        ylabel=&quot;Energy Transfer (meV)&quot;,
        aspect = 1.4,
    ),
    colorrange = (0, 40.0)
)</code></pre><p><img src="CoRh2O4-tutorial-63.png" alt/></p><h3 id="Calculation-of-temperature-dependent-powder-average-spectrum"><a class="docs-heading-anchor" href="#Calculation-of-temperature-dependent-powder-average-spectrum">Calculation of temperature-dependent powder average spectrum</a><a id="Calculation-of-temperature-dependent-powder-average-spectrum-1"></a><a class="docs-heading-anchor-permalink" href="#Calculation-of-temperature-dependent-powder-average-spectrum" title="Permalink"></a></h3><p>Define a temperature schedule</p><pre><code class="language-julia hljs">kTs        = [60 40 25 20 15 12 10 4] * Sunny.meV_per_K
pqw_res    = []
for kT in kTs
    dwell!(sys, integrator; kTtarget=kT, ndwell=1000);
    sc_loc = dynamical_correlations(sys; Œît=Œît0, nœâ, œâmax, process_trajectory=:symmetrize);
    add_sample!(sc_loc, sys)
    formula = intensity_formula(sc, :perp; formfactors, kT)
    push!(pqw_res, powder_average(sc_loc, Qpow, npoints, formula; Œ∑))
end</code></pre><pre><code class="nohighlight hljs">‚îå Warning: Assignment to `formula` in soft scope is ambiguous because a global variable by the same name exists: `formula` will be treated as a new local. Disambiguate by using `local formula` to suppress this warning or `global formula` to assign to the existing global variable.
‚îî @ ~/Research/SunnyContributed/contributed-docs/build/CoRh2O4-tutorial.md:7
Powder Averaging:  83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç     |  ETA: 0:00:02[KPowder Averaging: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| Time: 0:00:12[K
Powder Averaging:  83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç     |  ETA: 0:00:02[KPowder Averaging: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| Time: 0:00:12[K
Powder Averaging:  83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç     |  ETA: 0:00:02[KPowder Averaging: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| Time: 0:00:12[K
Powder Averaging:  83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç     |  ETA: 0:00:02[KPowder Averaging: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| Time: 0:00:12[K
Powder Averaging:  81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä      |  ETA: 0:00:02[KPowder Averaging: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| Time: 0:00:12[K
Powder Averaging:  83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç     |  ETA: 0:00:02[KPowder Averaging: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| Time: 0:00:12[K
Powder Averaging:  81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä      |  ETA: 0:00:02[KPowder Averaging: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| Time: 0:00:12[K
Powder Averaging:  87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    |  ETA: 0:00:02[KPowder Averaging: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| Time: 0:00:11[K
</code></pre><p>Plot the resulting Ipow(|Q|,W) as a function of temperature, to compare with Fig.6 of https://arxiv.org/abs/1706.05881</p><pre><code class="language-julia hljs">fig = Figure(; resolution=(1200,600))
for i in 1:8
    r, c = fldmod1(i, 4)
    ax = Axis(fig[r, c];
        title = &quot;kT = &quot;*string(round(kTs[9-i], digits=3))*&quot; (meV)&quot;,
        xlabel = r == 2 ? &quot;|Q| (√Ö‚Åª¬π)&quot; : &quot;&quot;,
        ylabel = c == 1 ? &quot;Energy Transfer (meV)&quot; : &quot;&quot;,
        aspect = 1.4,
    )
    heatmap!(ax, Qpow, œâs, pqw_res[9-i]; colorrange = (0, 20.0))
end
fig</code></pre><p><img src="CoRh2O4-tutorial-68.png" alt/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../spinw/SW15_Ba3NbFe3Si2O14.html">¬´ Tutorial 15 - Ba‚ÇÉNbFe‚ÇÉSi‚ÇÇO‚ÇÅ‚ÇÑ</a><a class="docs-footer-nextpage" href="MgCr2O4-tutorial.html">MgCr2O4 at Finite Temperature ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.2 on <span class="colophon-date" title="Tuesday 31 October 2023 04:26">Tuesday 31 October 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
