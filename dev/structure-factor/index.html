<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Structure Factor Calculations · Sunny documentation</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="Sunny documentation logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">Sunny documentation</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Overview</a></li><li><a class="tocitem" href="../quick-start/">Quick Start</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/fei2_tutorial/">Case Study: FeI<span>$_{2}$</span></a></li><li><a class="tocitem" href="../examples/powder_averaging/">Powder Averaging</a></li></ul></li><li><a class="tocitem" href="../library/">Library API</a></li><li class="is-active"><a class="tocitem" href>Structure Factor Calculations</a><ul class="internal"><li><a class="tocitem" href="#Overview"><span>Overview</span></a></li><li><a class="tocitem" href="#Basic-Usage"><span>Basic Usage</span></a></li></ul></li><li><a class="tocitem" href="../versions/">Version History</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Structure Factor Calculations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Structure Factor Calculations</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SunnySuite/Sunny.jl/blob/main/docs/src/structure-factor.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Structure-Factor-Calculations"><a class="docs-heading-anchor" href="#Structure-Factor-Calculations">Structure Factor Calculations</a><a id="Structure-Factor-Calculations-1"></a><a class="docs-heading-anchor-permalink" href="#Structure-Factor-Calculations" title="Permalink"></a></h1><h2 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h2><p>The dynamical structure factor is of fundamental importance for characterizing a magnetic system, and facilitates quantitative comparison between theory and experimental scattering data.</p><p>Consider, for example, a two-point dynamical spin correlation function, <span>$⟨s^α(𝐱+Δ𝐱, t+Δt) s^β(𝐱, t)⟩$</span>. Here <span>$s^α(𝐱, t)$</span> represents the time dynamics of a spin dipole component <span>$α$</span> at position <span>$𝐱$</span>, and brackets represent an average over equilibrium initial conditions and over <span>$(𝐱, t)$</span>. The dynamical structure factor is defined as the Fourier transform of this two-point correlation in both space and time, up to an overall scaling factor. Using the convolution theorem, the result is,</p><p class="math-container">\[𝒮^{αβ}(𝐪, ω) = \frac{1}{V} ⟨ŝ^α(𝐪, ω)^\ast ŝ^β(𝐪, ω) ⟩,\]</p><p>with <span>$V$</span> the system volume. We will restrict attention to lattice systems with periodic boundaries.</p><p>Consider a crystal unit cell defined by three lattice vectors <span>$𝐚_1, 𝐚_2, 𝐚_3$</span>, and linear system sizes <span>$L_1, L_2, L_3$</span> measured in unit cells. The allowed momentum vectors take on discrete values <span>$𝐪 = \sum_{α=1}^{3} m_α 𝐛_α / L_α$</span>, where <span>$m_α$</span> are an integers and the reciprocal lattice vectors <span>$𝐛_α$</span> are defined to satisfy <span>$𝐚_α ⋅ 𝐛_β = 2π δ_{α,β}$</span>. For a Bravais lattice, <span>$𝐪$</span> will be periodic in the first Brillouin zone, i.e., under any shift <span>$𝐪 → 𝐪 ± 𝐛_α$</span>. More generally, consider a non-Bravais lattice such that each unit cell may contain multiple spins. By partitioning spins <span>$s_j(𝐱,t)$</span> according to their sublattice index <span>$j$</span>, the relevant momenta <span>$𝐪$</span> remain discretized as above, but now periodicity in the first Brillouin zone is lost. The structure factor may be written as a phase-average over the displacements between sublattices <span>$𝐫_{j,k}$</span>,</p><p class="math-container">\[𝒮^{αβ}(𝐪, ω) = ∑_{j,k} e^{i 𝐫_{j,k} ⋅ 𝐪} 𝒮̃^{αβ}_{j,k}(𝐪, ω) ⟩,\]</p><p>From a theoretical perspective, the quantity</p><p class="math-container">\[𝒮̃^{αβ}_{j,k}(𝐪, ω) = \frac{1}{V} ⟨ŝ_j^α(𝐪, ω)^\ast ŝ_k^β(𝐪, ω)⟩\]</p><p>is fundamental. For each sublattice <span>$j$</span>, the data <span>$ŝ_j^α(𝐪, ω)$</span> can be efficiently obtained by fast Fourier tranformation of a real space configuration <span>$s_j^α(𝐱, t)$</span>. Internally, Sunny will calculate and store the discrete <span>$𝒮̃^{αβ}_{j,k}(𝐪, ω)$</span> correlation data, and use this to construct <span>$𝒮^{αβ}(𝐪,ω)$</span> intensities that can be compared with experiment.</p><p>Calculating this structure factor involves several steps, with various possible settings. Sunny provides a number of tools to facilitate this calculation and to extract information from the results. These tools are briefly outlined below. &quot;Real life&quot; use cases can be found in our tutorials and detailed function information is available in the Library API.</p><h2 id="Basic-Usage"><a class="docs-heading-anchor" href="#Basic-Usage">Basic Usage</a><a id="Basic-Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-Usage" title="Permalink"></a></h2><p>The basic data type for calculating, storing and retrieving structure factor data is <code>StructureFactor</code>. Rather than creating a <code>StructureFactor</code> directly, one should call either <code>DynamicStructureFactor</code>, for <span>$𝒮^{αβ}(𝐪,ω)$</span>, or <code>StaticStructureFactor</code>, for <span>$𝒮^{αβ}(𝐪)$</span>. These functions will configure and return an appropriate <code>StructureFactor</code>.</p><h3 id="Calculating-a-dynamical-stucture-factor"><a class="docs-heading-anchor" href="#Calculating-a-dynamical-stucture-factor">Calculating a dynamical stucture factor</a><a id="Calculating-a-dynamical-stucture-factor-1"></a><a class="docs-heading-anchor-permalink" href="#Calculating-a-dynamical-stucture-factor" title="Permalink"></a></h3><p>Calling <code>DynamicStructureFactor(sys; Δt, ωmax, nω)</code> will create a <code>StructureFactor</code> for the user and calculate an initial sample. There are three keywords that must be specified. These keywords will determine the dynamics used to calculate the sample and, consequently, the <span>$ω$</span> information that will be available after the calculation has completed.</p><ol><li><code>Δt</code>: Determines the step size used for simulating the dynamics. A smaller number will require proportionally more calculation time. While a smaller <code>Δt</code> will enable the resolution of higher energies, <code>Δt</code> is typically selected to ensure numerical stability rather than to maximize the largest <span>$ω$</span> value. A safe choice is to use the smaller value of <code>Δt = 0.1/(J* S^2)</code> or <code>Δt = 0.1/(D * S)</code>, where <code>S</code> is magnetic moment of the largest local spin (as specified in <a href="../library/#Sunny.SpinInfo"><code>SpinInfo</code></a>), <code>J</code> is the parameter governing the largest bilinear interaction (e.g. exchange), and <code>D</code> is the parameter governing the largest single-site term of the Hamiltonian (e.g., anisotropy or Zeeman term).</li><li><code>ωmax</code>: Sets the maximum resolved energy. Note that this is not independent of <code>Δt</code>. If <code>ωmax</code> too large, Sunny will throw an error and ask you to choose a smaller <code>Δt</code>. </li><li><code>nω</code>: Determines the number of energy bins to resolve. A larger number will require more calculation time.</li></ol><p>Upon constructing <code>DynamicStructureFactor</code>, classical spin dynamics will be performed, and spin correlation data will be accumulated into <span>$𝒮^{αβ}(𝐪,ω)$</span>. The input <code>sys</code> must be a spin configuration in good thermal equilibrium, e.g., using the continuous <a href="../library/#Sunny.Langevin"><code>Langevin</code></a> dynamics or using single spin flip trials with <a href="../library/#Sunny.LocalSampler"><code>LocalSampler</code></a>. The statistical quality of the <span>$𝒮^{αβ}(𝐪,ω)$</span> can be improved by generating a decorrelated spin configuration in <code>sys</code>, and then calling <a href="../library/#Sunny.add_sample!-Tuple{StructureFactor, System}"><code>add_sample!(structure_factor, sys)</code></a>.</p><p>The outline of typical use case might look like this:</p><pre><code class="nohighlight hljs"># Make a `StructureFactor` and calculate an initial sample
sf = DynamicStructureFactor(sys; Δt=0.05, ωmax=10.0, nω=100) 

# Add additional samples
for _ in 1:nsamples
   decorrelate_system(sys) # Perform some type of Monte Carlo simulation
   add_sample!(sf, sys)    # Use spins to calculate and accumulate new sample of 𝒮(𝐪,ω)
end</code></pre><p>The calculation may be configured in a number of ways; see the <a href="../library/#Sunny.DynamicStructureFactor-Tuple{System}"><code>DynamicStructureFactor</code></a> documentation for a list of all keywords.</p><h3 id="Calculating-a-static-structure-factor"><a class="docs-heading-anchor" href="#Calculating-a-static-structure-factor">Calculating a static structure factor</a><a id="Calculating-a-static-structure-factor-1"></a><a class="docs-heading-anchor-permalink" href="#Calculating-a-static-structure-factor" title="Permalink"></a></h3><p>Sunny provides two methods for calculating static structure factors, <span>$𝒮^{αβ}(𝐪)$</span>. The first involves calculating spin-spin correlations at single instances of time. The second involves calculating a dynamic structure factor first and integrating out the <span>$ω$</span> information. The advantage of the latter approach is that it enables application of an <span>$ω$</span>-dependent classical-to-quantum rescaling of structure factor intensities, a method that should be preferred whenever comparing results to experimental data or spin wave calculations. A disadvantage of this approach is that it is computationally more expensive. There are also many cases when it is not straightforward to calculate a meaningful dynamics, as when working with Ising spins. In this section we will discuss how to calculate static structure factors from static spin configurations. Information about calculating static data from a dynamic structure factor can be found in the following section.</p><p>The basic usage for the static case is very similar to the dynamic case, except one calls <code>StaticStructureFactor(sys)</code> instead of <code>DynamicStructureFactor</code>. Note that there are no required keywords as there is no need to specify any dynamics. <code>StaticStructureFactor</code> will immediately calculate a sample of <span>$𝒮(𝐪)$</span> using the spin configuration contained in <code>sys</code>. It is therefore important that  <code>sys</code> be properly thermalized before calling this function. Additional samples may be added with <code>add_sample!(sf, sys)</code>, just as was done in the dynamic case. As was true there, it is important to ensure that the spins in <code>sys</code> represents a new equilibrium sample before calling <code>add_sample!</code>.</p><h3 id="Extracting-information-from-structure-factors"><a class="docs-heading-anchor" href="#Extracting-information-from-structure-factors">Extracting information from structure factors</a><a id="Extracting-information-from-structure-factors-1"></a><a class="docs-heading-anchor-permalink" href="#Extracting-information-from-structure-factors" title="Permalink"></a></h3><p>The basic function for extracting information from a dynamic <code>StructureFactor</code> at a particular wave vector, <span>$𝐪$</span>, is <a href="../library/#Sunny.intensities-Tuple{StructureFactor, Any, Any}"><code>intensities</code></a>. It takes a <code>StructureFactor</code>, a list of wave vectors, and a contraction mode. For example, <code>intensities(sf, [[0.0, 0.5, 0.5]], :trace)</code> will calculate intensities for the wavevector <span>$𝐪 = (𝐛_2 + 𝐛_3)/2$</span>. The option <code>:trace</code> will contract spin indices, returning <span>$𝒮^{αα}(𝐪,ω)$</span>. The option <code>:perp</code> will instead perform a contraction that includes polarization corrections. The option <code>:full</code> will return data for the full tensor <span>$𝒮^{αβ}(𝐪,ω)$</span>. <code>intensities</code> returns a list of <code>nω</code> elements. The corresponding <span>$ω$</span> values are given by <code>ωvals(sf)</code>, where <code>sf</code> is the <code>StructureFactor</code>.</p><p>Since Sunny currently only calculates the structure factor on a finite lattice, it is important to realize that exact information is only available at a discrete set of wave vectors. Specifically, for each axis index <span>$i$</span>, we will get information at <span>$q_i = \frac{n}{L_i}$</span>, where <span>$n$</span> runs from <span>$(\frac{-L_i}{2}+1)$</span> to <span>$\frac{L_i}{2}$</span> and <span>$L_i$</span> is the linear dimension of the lattice used for the calculation. If you request a wave vector that does not fall into this set, Sunny will automatically round to the nearest <span>$𝐪$</span> that is available. If <code>intensities</code> is given the keyword argument <code>interpolation=:linear</code>, Sunny will use trilinear interpolation to determine the results at the requested wave vector. </p><p>To retrieve the intensities at all wave vectors for which there is exact data, first call the function <a href="../library/#Sunny.all_exact_wave_vectors-Tuple{StructureFactor}"><code>all_exact_wave_vectors</code></a> to generate a list of <code>qs</code>. This takes an optional keyword argument <code>bzsize</code>, which must be given a tuple of three integers specifying the number of Brillouin zones to calculate, e.g., <code>bzsize=(2,2,2)</code>. The resulting list of wave vectors may then be passed to <code>intensities</code>.</p><p>The convenience function <a href="../library/#Sunny.connected_path-Tuple{Vector, Any}"><code>connected_path</code></a> returns a list of wavevectors sampled along a path that connects specified <span>$𝐪$</span> points. This list can be used as an input to <code>intensities</code>.</p><p>A number of keyword arguments are available which modify the calculation of structure factor intensity. See the documentation of <a href="../library/#Sunny.intensities-Tuple{StructureFactor, Any, Any}"><code>intensities</code></a> for a full list. It is generally recommended to provide a value to <code>kT</code> corresponding to the temperature of sampled configurations. Given <code>kT</code>, Sunny will apply an energy- and temperature-dependent classical-to-quantum rescaling of intensities. </p><p>To retrieve intensity data from a static structure factor, use <a href="../library/#Sunny.static_intensities-Tuple{StructureFactor, Any, Any}"><code>static_intensities</code></a>, which shares keyword arguments with <a href="../library/#Sunny.intensities-Tuple{StructureFactor, Any, Any}"><code>intensities</code></a>. This function may also be used to calculate static information from a dynamical structure factor. Note that it is important to supply a value to <code>kT</code> to reap the benefits of this approach over simply calculating a static structure factor at the outset. </p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../library/">« Library API</a><a class="docs-footer-nextpage" href="../versions/">Version History »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Wednesday 8 February 2023 18:04">Wednesday 8 February 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
